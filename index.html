<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/site.webmanifest">

    <!--<link rel="stylesheet" href="style.css">-->
    <style>
        body{
            background-color: #0e2b43;
            color: white;
            margin: 0;
            padding: 0;
            font-size: 16px;
        }
        h1{
            color: white;
            font-size: 56px;
            font-weight: 700;
        }
        .heading{
            width: 100%;
            text-align: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .intro, .how-it-works {
            opacity: 0;
            transition: opacity 2s ease-in-out;
        }
        .heading {
            opacity: 0;
            transition: opacity 2s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .intro.visible{
            animation: fadeIn 2s forwards;
        }
        .how-it-works.visible{
            animation: fadeIn 2s forwards;
        }
        .heading.visible{
            animation: fadeIn 2s forwards;
        }
        .player-content.visible{
            animation: fadeIn 2s forwards;
        }
        
        li{
            list-style: none;
        }
        
        .main{
            display: flex;
            flex-direction: column;
            width: 100%;
            align-items: center;
            overflow: hidden;
        }
        .highlight{
            color: #eabc6f;
        }
        .intro{
            width: 95%;
            text-align: center;
            line-height: 2;
            word-spacing: 2px;
        }

        .how-it-works {
            text-align: center;
            padding: 10px 0px 10px 0px;
            color: white;
            max-width: 900px;
            margin: 0 auto;
        }

        .how-it-works h2 {
            margin: 10px 0 30px 0;
            color: #eabc6f;
            
        }
        h2{
            font-size: 50px;
            font-weight: 600;
        }

        .step-container {
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
        }

        .step {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin: 40px 0;
            padding: 10px 0;
            position: relative;
        }

        .step:nth-child(even) .step-text {
            order: 2;
        }

        .step:nth-child(even) .step-image {
            order: 1;
        }

        .step-text, .step-image {
            width: 45%;
        }
        .step-text{
            border: 2px solid #13507A;
            box-shadow: 0px 2px 18px 0px #13507A;
            margin: 10px;
        }

        .step-text h3 {
            color: white;
            text-align: left;
            padding: 2px 0  2px 15px;
            margin: 10px 0 10px 0;        
        }
        h3{
            font-size: 35px;
            font-weight: 500;
        }

        .step-text p {
            color: white;
            line-height: 1.6;
            word-spacing: 1.6px;
            padding: 10px;
        }

        .step-image img {
            width: 100%;
            height: auto;
            border-radius: 10px;
        }

        .step-container::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            width: 3px;
            background-color: white; 
            transform: translateX(-50%);
        }
        .step-logo {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            top: -30px; 
            z-index: 5;
            background-color: #13507A;
            border-radius: 50%;
            padding: 5px;
            opacity: 0;
            transition:opacity 0.5s ease-out, box-shadow 0.5s ease-out;;
            
        }

        .step-logo img {
            width: 70px;
            height: 70px;
            border-radius: 50%; 
            opacity: 0; 
            transform: scale(0);
            transition: transform 0.5s ease-out, opacity 0.5s ease-out;

        }
        .step-text {
            opacity: 0;
        transform: scale(0);
        transition: transform 0.5s ease-out, opacity 0.5s ease-out;

        }
        .step.show-step {
            opacity: 1;
            transform: none; 
        }

        .step-logo img.show-logo{
            opacity: 1;
            transform: scale(1); 
        }
        .step-logo.show-logo{
            opacity: 1;
            box-shadow: 0px 0px 12px 0px #eabc6f;
        }

        .step-text.show-text {
            opacity: 1;
            transform: scale(1);
        }
        .player-Section{
            width: 100%;
            flex-direction: column;
            align-items: center;
        }
        .player-content{
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity:0;
            margin: 20px ;
        }
        #videoUrl,#startTime,#endTime{
            background-color: transparent;
            border: 1px white solid;
            margin: 5px;
            padding: 8px;
            width: auto;
            color: white;
        }
        .sub button{
            padding: 10px;
            background-color: #eabc6f;
            border-radius: 5px;
            margin: 15px 0;    
            font-size: 12px;
        }
        hr{
            width: 90%;
            color: #eabc6f;
        }
        label{
            font-size: 16px;
        }
        table,td{
            border: none;
            text-align: center;
        }
        td{
            padding: 10px;
        }

        @font-face {
    font-family: 'Amiri Quran';
    src: url('https://cdn.jsdelivr.net/gh/alif-type/amiri@master/fonts/amiri-quran.ttf');
}

.verse-contents {
    font-family: Arial, sans-serif;
    margin-top: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 80%;
}

.verse-contents h1 {
    color: #2c3e50;
    text-align: center;
}

select, button, input {
    margin: 5px;
    padding: 10px;
    font-size: 16px;
    background-color: white;
    color: black;
}

#versesContainer {
    margin-top: 20px;
    padding: 20px;
    border: 1px solid #ddd;
    border-radius: 5px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    color: white;
    width: 100%;
}

.verse {
    margin-bottom: 20px;
    padding: 10px 0;
    border-bottom: 1px solid #eee;
}

.verse-key {
    font-size: 16px;
    font-weight: bold;
    margin-bottom: 5px;
    color: white;
}

.verse-text {
    text-align: right;
    font-size: 40px;
    line-height: 2;
    font-family: 'Amiri Quran', serif;
    color: white;
    direction: rtl;
    font-weight: 500;
}

.translation-text {
    font-size: 20px;
    color: white;
    margin-top: 10px;
}

.error {
    color: #eabc6f;
    font-weight: bold;
}

.navigation-buttons {
    margin-top: 15px;
    display: flex;
    justify-content: space-evenly;
    width: 100%;
}

.navigation-buttons button {
    padding: 10px 15px;
    font-size: 16px;
    background-color: #eabc6f;
    color: black;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.navigation-buttons button:hover {
    background-color: #0056b3;
}

.verse-selection{
    width: 100%;
    display: flex;
    flex-direction: row;
    justify-content: space-evenly;
    align-items: center;
}
#video-carousel{
    width: 90%;
    text-align: center;
    margin: 0px 0 30px 0;

}
#video-carousel h2{
    margin: 25px 0;
}
.carousel {
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
    gap: 10px;
    overflow-x: auto;
    padding: 20px 0;
}

.carousel-item {
    width: 300px;
    height: 200px;
    flex-shrink: 0;
    cursor: pointer;
    border: 2px solid transparent;
    transition: transform 0.3s, border-color 0.3s;
}

.carousel-item:hover {
    transform: scale(1.05);
    border-color: #eabc6f;
} 

.carousel iframe {
    pointer-events: none; 
    width: 100%;
    height: 100%;
}

.carousel::-webkit-scrollbar {
    height: 8px;
    width: 2px;
}

.carousel::-webkit-scrollbar-thumb {
    background: #eabc6f;
    border-radius: 10px;
}
.load-video, .refer-button{
    background-color: #eabc6f;
    color: black;
    padding: 12px 20px;
    border-radius: 50px;
    cursor: pointer;
}
.load-verse{
    background-color: #eabc6f;
    padding: 12px 20px;
    border-radius: 50px;
    font-size:12px;
    cursor: pointer;
}
.how-it-works-button{
    position: fixed;
    z-index: 999;
    right: -3.5%;
    top: 45%;
    transform: translateY(-50%) rotate(-90deg);
    padding: 10px 20px;
    background-color: #0056b3;
    color: white;
    border-radius: 5px;
    cursor: pointer;
    font-size: 20px;
    transition: transform 0.3s ease;
    font-weight: 500;
}
.step-text h4{
    margin: 0;
}
.player-row{
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: space-around;
    width: 75%;
}
#player{
    width: 60%;
}
.video-input{
    display: flex;
    flex-direction: column;
    align-items: center;
}
.verse-contents select, input{
    border-radius: 5px;
}       
        @media(max-width: 2600px){
            .how-it-works-button{
                right: -2%;
            }
        }
        @media(max-width: 1800px)
        {
            .how-it-works-button{
                right: -3.5%;
            }
        }
        @media (max-width: 770px)
        {
            h1, .highlight{
                font-size: 46px;
            }
            p,label{
                font-size: 14px;
            }
            h2{
                font-size: 40px;
            }
            h3{
                font-size: 25px;            }
            .sec2{
                display: none;
            }
            #player{
                display: flex;
                flex-direction: column;
                align-items: center;
                width: 100%;
                justify-content: center;
            }
        }
        @media (max-width: 620px)
        {
            
            .step-text p{
                text-align: left;
                word-spacing: 0;
            }
            .intro{
                text-align: justify;
                word-spacing: 0;
            }
            .sec1{
                width: 40%;
            }
            .logo img{
                width: 100%;
            }
            
            #player{
                width: 100%;
            }
            
            input{
                width: 100%;
            }
           
            .step-logo img{
                width: 60px;
                height: 60px;
            }
        }
        @media (max-width: 1030px)
    {
        .how-it-works-button{
            right: -5%;
        }
        .player-row{
            width: 95%;
        }
        .video-input{
            width: 80%;
        }
        .verse-contents{
            width: 90%;
        }
    }
@media (max-width: 770px){
    .how-it-works-button{
        font-size: 15px;

    }
    .player-row label, input,.load-video,.refer-button{
        font-size: 12px;
    }
    td{
        padding-right: 2px;
    }
    #surahSelect{
        font-size: 12px;
    }
    #player{
        width: 70%;
        height: 50vh;
    }
}
@media(max-width: 540px){
    .player-row{
        flex-direction: column;
    }
    .video-input{
        width: 80%;
    }
    #player{
        width: 75%;
        height: 45vh;
    }
    .player-row label, input,.load-video,.refer-button{
        font-size: 14px;
    }
    .how-it-works-button{
        right: -7%;
        font-size: 13px;
    }
    .surah-section{
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 40%;
    }
    #verseInput{
        width: 70%;
    }
    .verse-contents{
        margin-top: 25px;
    }
    #versesContainer{
        width: 95%;
    }
}
@media(max-width: 430px){
    .video-input{
        width: 95%;
    }
    .how-it-works-button{
        right: -9%;
        top: 30%;
    }
    .carousel{
        flex-wrap: wrap;
        justify-content: center;
        height: 50vh;
    }
    .carousel::-webkit-scrollbar {
        width: 2px;
    }
    .carousel-item{
        width: 280px;
        height: 175px;
    }
    .verse-text{
        font-size: 35px;
    }
    .translation-text{
        font-size: 16px;
    }
    .navigation-buttons button{
        font-size:12px ;
    }
}
@media(max-width: 380px){
    .how-it-works-button{
        right: -10%;
    }.video-input{
        width: 100%;
    }
    .player-row label, input,.load-video,.refer-button{
        font-size: 12px;
    }
    .surah-section label, .load-verse{
        font-size: 12px;
    }
    .step-text p {
        text-align: center;
    }
    
}
@media(max-width: 320px){
    .video-input{
        width: 100%;
    }
    #videoUrl, #startTime, #endTime{
        width: 70%;
    }
    .how-it-works-button{
        right: -11%;
    }
}
    </style>
    <title>Loop And Learn | Ibi Idris</title>
</head>
<body>
    <div class="main">
        <div class="how-it-works-button" onclick="scrollToHowItWorks()">
            How It Works
        </div>
        <div class="heading">
            <h1 class="animation">
                Loop & Learn: <span class="highlight">Quran </span>Memorization Made Easy
            </h1>
        </div>
        <div class="intro">
            <p>
                Looping Quranic recitation is an effective way to memorize, as repeated listening strengthens memory while simultaneous reading enhances retention. This combined approach allows learners to focus on specific verses, making the memorization process faster and more efficient. The addition of translations further adds value by clarifying the meanings of the verses, deepening understanding and connection with the Quran. By listening, reading, and understanding the translation, learners can memorize more effectively while mastering accurate recitation techniques, tajweed, and rhythm in a meaningful and engaging way.
            <br><br>
            <hr>
        </div>
        <div class="player-content">
            <!-- Input Fields Section -->
            <div class="player-row">
                <div class="sub video-input">
                    <table>
                        <tr>
                            <td>
                                <label for="videoUrl">YouTube Video URL:</label>
                            </td>
                            <td>
                                <input type="text" id="videoUrl" placeholder="Enter YouTube URL">
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="startTime">Start Time (hh:mm:ss):</label> 
                            </td>
                            <td>
                                <input type="text" id="startTime" placeholder="00:00:00">
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="endTime">End Time (hh:mm:ss):</label>
                            </td>
                            <td>
                                <input type="text" id="endTime" placeholder="00:00:00">
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="sub">
                                    <div class="load-video" onclick="loadVideo()">Load Video</div>
                                </div>
                            </td>
                            <td>
                                <div class="refer">
                                    <div class="refer-button" onclick="scrollToVerses()">
                                        Refer Quran
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
                <div id="player">
                    <p id="fallbackMessage" style="display: block; color: #eabc6f; text-align: center;">
                        Oops! Something went wrong. Please refresh the page to reload the video or open a new tab and try again."
                    </p>
                </div>
            </div>
        </div>
        <hr>
        <!-- Carousel Section -->
        <div id="video-carousel">
            <h2>Memorize from Qari Ibrahim Idris</h2>
            <div class="carousel">
                <div class="carousel-item" onclick="setVideoLink('https://youtu.be/SfZF3XvLtPM?si=DLdMbgJFjmMMEZH1', event)">
                    <iframe 
                        src="https://www.youtube.com/embed/SfZF3XvLtPM" 
                        frameborder="0" 
                        allowfullscreen>
                    </iframe>
                </div>
                <div class="carousel-item" onclick="setVideoLink('https://youtu.be/q-U2H6F26_Q', event)">
                    <iframe 
                        src="https://www.youtube.com/embed/q-U2H6F26_Q" 
                        frameborder="0" 
                        allowfullscreen>
                    </iframe>
                </div>
                <div class="carousel-item" onclick="setVideoLink('https://youtu.be/DeVB2YJOXbs', event)">
                    <iframe 
                        src="https://www.youtube.com/embed/DeVB2YJOXbs" 
                        frameborder="0" 
                        allowfullscreen>
                    </iframe>
                </div>
                <div class="carousel-item" onclick="setVideoLink('https://youtu.be/0CME-y4Usik?si=7zIH8VvZAScy2QYg', event)">
                    <iframe 
                        src="https://www.youtube.com/embed/0CME-y4Usik?si=7zIH8VvZAScy2QYg" 
                        frameborder="0" 
                        allowfullscreen>
                    </iframe>
                </div>
                <div class="carousel-item" onclick="setVideoLink('https://youtu.be/7fSS6VYvlmk', event)">
                    <iframe 
                        src="https://www.youtube.com/embed/7fSS6VYvlmk" 
                        frameborder="0" 
                        allowfullscreen>
                    </iframe>
                </div>
                <div class="carousel-item" onclick="setVideoLink('https://youtu.be/7-PO73JhfLk?si=qM_llLFdA-ZrCikW', event)">
                    <iframe 
                        src="https://www.youtube.com/embed/7-PO73JhfLk?si=qM_llLFdA-ZrCikW" 
                        frameborder="0" 
                        allowfullscreen>
                    </iframe>
                </div>
                <div class="carousel-item" onclick="setVideoLink('https://youtu.be/deSBChoA5xU?si=--bmep_qvqkBT6hg', event)">
                    <iframe 
                        src="https://www.youtube.com/embed/deSBChoA5xU?si=--bmep_qvqkBT6hg"
                        frameborder="0" 
                        allowfullscreen>
                    </iframe>
                </div>
                <div class="carousel-item" onclick="setVideoLink('https://youtu.be/kFUIuFkPAUg?si=GF253-q5XbtJ0gkW', event)">
                    <iframe 
                        src="https://www.youtube.com/embed/kFUIuFkPAUg?si=UMMKI2NqOMAWZ52Y"
                        frameborder="0" 
                        allowfullscreen>
                    </iframe>
                </div>
                <div class="carousel-item" onclick="setVideoLink('https://youtu.be/6HRM3jBpj2Y?si=LEwEMEhDWgAnDt5o', event)">
                    <iframe 
                        src="https://www.youtube.com/embed/6HRM3jBpj2Y?si=LEwEMEhDWgAnDt5o" 
                        frameborder="0" 
                        allowfullscreen>
                    </iframe>
                </div>
            </div>
        </div>
        <hr>
        <!--Verse Section-->
        <div class="verse-contents" id="verses">
                <div class="verse-selection">
                    <div class="surah-section">
                        <label for="surahSelect">Select Surah:</label>
                        <select id="surahSelect" onchange="fetchEntireSurah()">
                            <option value="" disabled selected>Select Surah</option>
                        </select>
                    </div>
                    <div class="surah-section">
                        <label for="verseInput">Enter Verse Number:</label>
                        <input type="number" id="verseInput" min="1">
                    </div>
                </div>
                <div style="margin-top:10px ;">
                    <button class="load-verse" onclick="fetchSpecificVerse()">Load Verse</button>
                </div>
                <div id="versesContainer">
                    Select a Surah or Load a specific verse from a surah.
                </div>
                <p id="errorMessage" class="error"></p>
        </div>
        <hr>
        <!--How it works section-->
        <div class="how-it-works" id="how-it-works">
            <h2>How It Works</h2>
            <div class="step-container">
                <div class="step">
                    <div class="step-logo">
                        <img src="https://ibiidrisacademy.com/wp-content/uploads/2024/07/logosqr-min.png" alt="Step 1 Logo">
                    </div>
                    <div class="step-text">
                        <h3>Step 1:</h3>
                        <h4>Option 1</h4>
                        <p>Copy the YouTube video link of the recitation or video you want to listen to and paste the copied link into the "YouTube Video URL" field on the page.</p>
                        <h4>Option 2</h4>
                        <p>Choose any pre-loaded recitaion from Qari Ibrahim Idris.</p>
                    </div>   
                    <div class="step-image">
                    </div>
                </div>
        
                <div class="step">
                    <div class="step-logo">
                        <img src="https://ibiidrisacademy.com/wp-content/uploads/2024/07/logosqr-min.png" alt="Step 2 Logo">
                    </div>
                    <div class="step-image">
                    </div>
                    <div class="step-text">
                        <h3>Step 2:</h3>
                        <p>
                            Enter the start time for the section you want to loop. Use the format: hours:minutes (e.g., 00:01:30 for 1 minute 30 seconds).
                        </p>
                    </div>
                </div>
        
                <div class="step">
                    <div class="step-logo">
                        <img src="https://ibiidrisacademy.com/wp-content/uploads/2024/07/logosqr-min.png" alt="Step 3 Logo">
                    </div>
                    <div class="step-text">
                        <h3>Step 3:</h3>
                        <p>
                            Enter the end time of the section you want to loop. Make sure itâ€™s after the start time.
                        </p>
                    </div>
                    <div class="step-image">
                    </div>
                </div>

                <div class="step">
                    <div class="step-logo">
                        <img src="https://ibiidrisacademy.com/wp-content/uploads/2024/07/logosqr-min.png" alt="Step 1 Logo">
                    </div>
                    <div class="step-image">
                        
                    </div>
                    <div class="step-text">
                        <h3>Step 4:</h3>
                        <p>
                            Click the "Load Video" button. The video will start playing and loop continuously between the start and end times you provided.
                        </p>
                    </div>
                    
                </div>

                <div class="step">
                    <div class="step-logo">
                        <img src="https://ibiidrisacademy.com/wp-content/uploads/2024/07/logosqr-min.png" alt="Step 1 Logo">
                    </div>
                    <div class="step-text">
                        <h3>Step 5:</h3>
                        <p>
                            Click on "Refer Quran" button, it will land you to Qaran Section. Select the Surah or load a specific verse from there.
                        </p>
                    </div>
                    <div class="step-image">
                        
                    </div>
                </div>

                <div class="step">
                    <div class="step-logo">
                        <img src="https://ibiidrisacademy.com/wp-content/uploads/2024/07/logosqr-min.png" alt="Step 1 Logo">
                    </div>
                    <div class="step-image">
                        
                    </div>
                    <div class="step-text">
                        <h3>Step 6:</h3>
                        <p>
                            To adjust the video loop, change the start or end times and reload the video by clicking the button again and load the verses accordingly.
                        </p>
                    </div>
                    
                </div>
            </div>
        </div>            
    </div>
    <div id="videoContainer"></div> 
    </div>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let player;
        let loopInterval;
        
        function getYouTubeVideoId(url) {
            const match = url.match(/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?/\s]{11})/);
            return match ? match[1] : null;
            
        }

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '390',
                width: '640',
                videoId: '',
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerReady(event) {
        }

        // Function to convert hh:mm:ss format to seconds
        function convertToSeconds(hhmmss) {
            const parts = hhmmss.split(':');
            const hours = parseInt(parts[0], 10) || 0;
            const minutes = parseInt(parts[1], 10) || 0;
            const seconds = parseInt(parts[2], 10) || 0;
            return hours * 3600 + minutes * 60 + seconds;
        }

        function loadVideo() {
            const url = document.getElementById('videoUrl').value;
            const startTime = convertToSeconds(document.getElementById('startTime').value);
            const endTime = convertToSeconds(document.getElementById('endTime').value);
            videoId =getYouTubeVideoId(url);
            if (videoId && startTime < endTime) {
                player.loadVideoById({
                    videoId: videoId,
                    startSeconds: startTime,
                    endSeconds: endTime
                });
                console.log("from timestamp == 1", url, startTime, endTime,videoId);


                if (loopInterval) clearInterval(loopInterval);

                // Loop video between start and end time
                loopInterval = setInterval(() => {
                    const currentTime = player.getCurrentTime();
                    if (currentTime >= endTime || currentTime < startTime) {
                        player.seekTo(startTime);
                    }
                }, 1000); // Check every second
            } 
        }

        
        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.ENDED) {
                // Handle video end event if necessary
            }
        }
        function setVideoLink(link, event) {
            // Prevent the iframe from playing
            event.preventDefault();

            // Set the link in the YouTube video URL input field
            const youtubeInput = document.getElementById("videoUrl");
            const startTime = document.getElementById("startTime");
            const endTime = document.getElementById("endTime");
            youtubeInput.value = link;
            startTime.value="";
            endTime.value="";
            // Automatically trigger the "Load Video" functionality
            playVideo();
        }
        let videoId;
        function playVideo() {
            const url = document.getElementById('videoUrl').value;
            videoId =getYouTubeVideoId(url);
            if(videoId){
                player.loadVideoById({
                videoId: videoId,
                });
                if (loopInterval) clearInterval(loopInterval);
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
    const heading = document.querySelector(".heading");
    const introSection = document.querySelector(".intro");
    const stepSection = document.querySelector(".how-it-works");
    const playerContent = document.querySelector(".player-content");
    setTimeout(() => {
        heading.classList.add("visible");
        setTimeout(() => {
            introSection.classList.add("visible");
        }, 800);
        setTimeout(() => {
            stepSection.classList.add("visible");
        }, 1200);
        setTimeout(() => {
            playerContent.classList.add("visible");
        }, 1400);
    }); 
});

document.addEventListener("DOMContentLoaded", function () {
    const steps = document.querySelectorAll(".step");

    // Function to trigger the animation for a step with a delay
    const triggerStepAnimation = (step, index) => {
        const logo = step.querySelector(".step-logo img");
        const logobox = step.querySelector(".step-logo");
        const text = step.querySelector(".step-text");

        // Delay the animation
        setTimeout(() => {
            // Show the logo with pop-out effect
            if (logo) {
                logo.classList.add("show-logo");
                logobox.classList.add("show-logo");
            }

            // Show the text with slide-in effect
            if (text) {
                text.classList.add("show-text");
            }

            // Apply slide-out effect based on the index
            step.classList.add("show-step"); // Show the step
        }, 300); // Delay for the logo and text animation
    };

    // Using IntersectionObserver to detect when each step is in the viewport
    const observer = new IntersectionObserver(
        (entries, observer) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    // Get the index of the current step
                    const index = Array.from(steps).indexOf(entry.target);

                    // Trigger the animation for the current step
                    triggerStepAnimation(entry.target, index);

                    // Disconnect the observer after triggering the animation for this step
                    observer.unobserve(entry.target);
                }
            });
        },
        {
            threshold: 1, // Trigger when 100% of the step is in view
        }
    );

    // Observe each step
    steps.forEach((step) => {
        observer.observe(step);
    });
    });
    const TRANSLATION_ID = 131; // ID for Dr. Mustafa Khattab's translation

    let currentSurah = null;
    let currentVerse = null;
    // Populate Surah Dropdown
    async function populateSurahDropdown() {
      try {
        const response = await fetch('https://api.quran.com/api/v4/chapters');
        const data = await response.json();
        const surahSelect = document.getElementById('surahSelect');
        data.chapters.forEach(chapter => {
          const option = document.createElement('option');
          option.value = chapter.id;
          option.textContent = `${chapter.id}: ${chapter.name_simple}`;
          surahSelect.appendChild(option);
        });
      } catch (error) {
        console.error('Error fetching Surah list:', error);
      }
    }

    // Fetch Entire Surah
    async function fetchEntireSurah() {
      const surahSelect = document.getElementById('surahSelect');
      const chapterNumber = surahSelect.value;
      const versesContainer = document.getElementById('versesContainer');
      const errorMessage = document.getElementById('errorMessage');
      versesContainer.innerHTML = 'Loading entire Surah...';
      errorMessage.textContent = '';
      const verseInput = document.getElementById('verseInput');
      verseInput.value="";
      if (!chapterNumber) {
        versesContainer.innerHTML = '<p>Please select a Surah first.</p>';
        return;
      }

      try {
        // Fetch verses in Indo-Pak script
        const versesResponse = await fetch(`https://api.quran.com/api/v4/quran/verses/indopak?chapter_number=${chapterNumber}`);
        const versesData = await versesResponse.json();
        const verses = versesData.verses;

        // Fetch translations
        const translationResponse = await fetch(`https://api.quran.com/api/v4/quran/translations/${TRANSLATION_ID}?chapter_number=${chapterNumber}`);
        const translationData = await translationResponse.json();
        const translations = translationData.translations;

        if (verses.length === 0 || translations.length === 0) {
          versesContainer.innerHTML = '<p>No verses or translations found for this Surah.</p>';
          return;
        }

        versesContainer.innerHTML = '';
        verses.forEach((verse, index) => {
          const verseNumber = verse.verse_key.split(':')[1]; // Extract verse number
          const arabicVerseNumber = new Intl.NumberFormat('ar-EG').format(verseNumber); // Convert to Arabic numeral
          const verseElement = document.createElement('div');
          const verseEndSymbol = '\u06DD';
          verseElement.className = 'verse';
          verseElement.innerHTML = `
            <p class="verse-key">${verse.verse_key}</p>
            <p class="verse-text">${verse.text_indopak}<span class="verse-end-symbol">(${arabicVerseNumber})</span></p>
            <p class="translation-text">${translations[index]?.text || 'Translation not available'}</p>
          `;
          versesContainer.appendChild(verseElement);
        });
      } catch (error) {
        versesContainer.innerHTML = `<p>Error fetching verses or translations: ${error.message}</p>`;
      }
    }

    // Navigate between verses
window.navigateVerse = function(direction, chapterNumber, currentVerseNumber) {
    const newVerseNumber = parseInt(currentVerseNumber) + direction;

    // Prevent negative verse numbers
    if (newVerseNumber < 1) return;

    // Update the verse input and fetch the new verse
    const verseInput = document.getElementById('verseInput');
    verseInput.value = newVerseNumber;
    fetchSpecificVerse();
};

// Add navigation buttons logic
async function fetchSpecificVerse() {
    const surahSelect = document.getElementById('surahSelect');
    const chapterNumber = surahSelect.value;
    const verseInput = document.getElementById('verseInput');
    const verseNumber = parseInt(verseInput.value, 10); // Convert to integer
    const versesContainer = document.getElementById('versesContainer');
    const errorMessage = document.getElementById('errorMessage');
    versesContainer.innerHTML = '';
    errorMessage.textContent = '';

    if (!chapterNumber || !verseNumber) {
        errorMessage.textContent = 'Please select a Surah and enter a valid verse number.';
        return;
    }

    try {
        // Fetch the total number of verses in the selected chapter
        const chapterInfoResponse = await fetch(`https://api.quran.com/api/v4/chapters/${chapterNumber}`);
        const chapterInfo = await chapterInfoResponse.json();
        const totalVerses = chapterInfo.chapter.verses_count;

        // Check if the entered verse number is valid
        if (verseNumber > totalVerses || verseNumber < 1) {
            errorMessage.textContent = `Invalid verse number. Surah ${chapterInfo.chapter.name_simple} consists of only ${totalVerses} verses.`;
            return;
        }

        // Fetch the specific verse in Indo-Pak script
        const verseResponse = await fetch(`https://api.quran.com/api/v4/quran/verses/indopak?chapter_number=${chapterNumber}&verse_key=${chapterNumber}:${verseNumber}`);
        const verseData = await verseResponse.json();
        const verse = verseData.verses[0];

        // Fetch the specific translation
        const translationResponse = await fetch(`https://api.quran.com/api/v4/quran/translations/${TRANSLATION_ID}?chapter_number=${chapterNumber}&verse_key=${chapterNumber}:${verseNumber}`);
        const translationData = await translationResponse.json();
        const translation = translationData.translations[0];

        if (!verse || !translation) {
            errorMessage.textContent = 'Verse or translation not found. Please enter a valid verse number.';
            return;
        }

        const arabicVerseNumber = new Intl.NumberFormat('ar-EG').format(verseNumber); // Convert to Arabic numeral
        const verseElement = document.createElement('div');
        verseElement.className = 'verse';
        verseElement.innerHTML = `
          <p class="verse-key">${verse.verse_key}</p>
          <p class="verse-text">${verse.text_indopak}<span class="verse-end-symbol"> (${arabicVerseNumber})</span></p>
          <p class="translation-text">${translation.text || 'Translation not available'}</p>
        `;

        // Add navigation buttons
        const navigationButtons = document.createElement('div');
        navigationButtons.className = 'navigation-buttons';

        // Previous button
        if (verseNumber > 1) {
            navigationButtons.innerHTML += `
                <button onclick="navigateVerse(-1, ${chapterNumber}, ${verseNumber})">Previous Verse</button>
            `;
        }

        // Next button
        if (verseNumber < totalVerses) {
            navigationButtons.innerHTML += `
                <button onclick="navigateVerse(1, ${chapterNumber}, ${verseNumber})">Next Verse</button>
            `;
        }

        versesContainer.appendChild(verseElement);
        versesContainer.appendChild(navigationButtons);
    } catch (error) {
        errorMessage.textContent = 'Error fetching the verse or translation. Please try again.';
    }
}

// Function to navigate between verses
async function navigateVerse(direction, chapterNumber, currentVerseNumber) {
    const newVerseNumber = currentVerseNumber + direction;
    document.getElementById('verseInput').value = newVerseNumber;
    await fetchSpecificVerse();
}
// Initialize the page
populateSurahDropdown();
function extractVideoId(url) {
    const match = url.match(/(?:https?:\/\/)?(?:www\.)?youtube\.com\/.*v=([^&]+)/) || url.match(/youtu\.be\/([^?]+)/);
    return match ? match[1] : null;
}

function parseTime(time) {
    const parts = time.split(":").map(Number);
    if (parts.length === 3) {
        return parts[0] * 3600 + parts[1] * 60 + parts[2];
    } else if (parts.length === 2) {
        return parts[0] * 60 + parts[1];
    } else if (parts.length === 1) {
        return parts[0];
    }
    return 0;
}
function scrollToHowItWorks() {
    const section = document.getElementById("how-it-works");
    section.scrollIntoView({ behavior: "smooth", block: "start" });
}
function scrollToVerses() {
    const section = document.getElementById("verses");
    section.scrollIntoView({ behavior: "smooth", block: "start" });
}
    </script>
</body>
</html>
